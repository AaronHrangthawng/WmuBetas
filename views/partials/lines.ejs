<!-- LINES SECTION -->
<section id="lines" class="bg-light text-center fade-in-section py-5">
  <div class="container">
    <h2 class="mb-5" style="color: #7851A9;">Lines Timeline</h2>

    <!-- Expand/Collapse Buttons -->
    <div class="mb-4 text-end">
      <button class="btn btn-sm btn-outline-primary me-2" onclick="expandAllLines()">Expand All</button>
      <button class="btn btn-sm btn-outline-secondary" onclick="collapseAllLines()">Collapse All</button>
    </div>

    <div class="accordion" id="linesAccordion">

      <% lines.forEach((line, i) => {
        const id = `line${i}`;
        const year = (line.date?.match(/\d{4}/) || [])[0] || "Unknown";
        let bgClass = "";

        if (year >= 2020) bgClass = "bg-decade-2020";
        else if (year >= 2010) bgClass = "bg-decade-2010";
        else if (year >= 2000) bgClass = "bg-decade-2000";
        else if (year >= 1990) bgClass = "bg-decade-1990";
        else bgClass = "bg-decade-1980";
      %>
        <div class="accordion-item shadow-sm rounded mb-3" data-aos="fade-up">
          <h2 class="accordion-header" id="heading-<%= id %>">
            <button class="accordion-button <%= i !== 0 ? 'collapsed' : '' %> <%= bgClass %>"
              type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= id %>" aria-expanded="<%= i === 0 %>" aria-controls="collapse-<%= id %>">
              <%= line.title %> <% if (line.date) { %> â€“ <%= line.date %> <% } %>
            </button>
          </h2>
          <div id="collapse-<%= id %>" class="accordion-collapse collapse <%= i === 0 ? 'show' : '' %>" aria-labelledby="heading-<%= id %>" data-bs-parent="#linesAccordion">
            <div class="accordion-body text-start">
              <% if (line.image) { %>
                <img src="/images/<%= line.image %>" alt="<%= line.title %>" class="img-fluid rounded mb-3" style="max-height: 200px;">
              <% } %>
              <ul class="list-unstyled">
                <% line.members.forEach(m => { %>
                  <li><strong><%= m %></strong></li>
                <% }) %>
              </ul>
              <% if (line.me) { %>
                <p class="mt-2"><em>ME: <%= line.me %></em></p>
              <% } %>
              <% if (line.ame) { %>
                <p><em>AME: <%= line.ame %></em></p>
              <% } %>
            </div>
          </div>
        </div>
      <% }) %>

    </div>
  </div>

  <script>
    function expandAllLines() {
      document.querySelectorAll('.accordion-collapse').forEach(collapse => collapse.classList.add('show'));
    }

    function collapseAllLines() {
      document.querySelectorAll('.accordion-collapse').forEach(collapse => collapse.classList.remove('show'));
    }
  </script>

  <style>
    .bg-decade-1980 { background-color: #e6e6fa !important; }
    .bg-decade-1990 { background-color: #f0e6ff !important; }
    .bg-decade-2000 { background-color: #efe0ff !important; }
    .bg-decade-2010 { background-color: #ead6ff !important; }
    .bg-decade-2020 { background-color: #e2cfff !important; }

    @media (max-width: 576px) {
      .accordion-button { font-size: 0.95rem; }
      .accordion-body { font-size: 0.9rem; }
    }
  </style>
</section>
