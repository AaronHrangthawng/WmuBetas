<% title = "Lines – Exotic Epsilon" %>

<section class="container py-5">
  <div class="text-center mb-5">
    <h2 class="display-5 fw-bold" style="color: #7851A9;">Lines Timeline</h2>
    <p class="lead">Explore the history of our lineages through the years.</p>
  </div>

  <!-- Expand/Collapse Buttons -->
  <div class="mb-4 text-end">
    <button class="btn btn-outline-primary btn-sm me-2" onclick="expandAllLines()">Expand All</button>
    <button class="btn btn-outline-secondary btn-sm" onclick="collapseAllLines()">Collapse All</button>
  </div>

  <div class="accordion" id="linesAccordion">
    <% lines.forEach((line, i) => {
      const id = `line${i}`;
      const year = (line.date?.match(/\d{4}/) || [])[0] || "Unknown";
      let bgClass = "";

      if (year >= 2020) bgClass = "bg-decade-2020";
      else if (year >= 2010) bgClass = "bg-decade-2010";
      else if (year >= 2000) bgClass = "bg-decade-2000";
      else if (year >= 1990) bgClass = "bg-decade-1990";
      else bgClass = "bg-decade-1980";
    %>
      <div class="accordion-item mb-3 shadow-sm rounded" data-aos="fade-up">
        <h2 class="accordion-header" id="heading-<%= id %>">
          <button class="accordion-button <%= i !== 0 ? 'collapsed' : '' %> <%= bgClass %>"
            type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= id %>"
            aria-expanded="<%= i === 0 %>" aria-controls="collapse-<%= id %>">
            <%= line.title %> <% if (line.date) { %> – <%= line.date %> <% } %>
          </button>
        </h2>
        <div id="collapse-<%= id %>" class="accordion-collapse collapse <%= i === 0 ? 'show' : '' %>"
             aria-labelledby="heading-<%= id %>" data-bs-parent="#linesAccordion">
          <div class="accordion-body text-start">
            <% if (line.image) { %>
              <img src="/images/<%= line.image %>" alt="<%= line.title %>" class="img-fluid rounded mb-3" style="max-height: 200px;">
            <% } %>
            <ul class="list-unstyled">
              <% line.members.forEach(m => { %>
                <li><strong><%= m %></strong></li>
              <% }) %>
            </ul>
            <% if (line.me) { %>
              <p class="mt-2"><em>ME: <%= line.me %></em></p>
            <% } %>
            <% if (line.ame) { %>
              <p><em>AME: <%= line.ame %></em></p>
            <% } %>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</section>

<script>
  function expandAllLines() {
    document.querySelectorAll('.accordion-collapse').forEach(c => c.classList.add('show'));
  }
  function collapseAllLines() {
    document.querySelectorAll('.accordion-collapse').forEach(c => c.classList.remove('show'));
  }
</script>

<style>
  .bg-decade-1980 { background-color: #f0f0ff !important; }
  .bg-decade-1990 { background-color: #e0eaff !important; }
  .bg-decade-2000 { background-color: #d9f0ff !important; }
  .bg-decade-2010 { background-color: #e0ffe5 !important; }
  .bg-decade-2020 { background-color: #fff3e0 !important; }
</style>
